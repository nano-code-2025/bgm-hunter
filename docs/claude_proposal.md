# 零输入BGM匹配器：技术实现方案

你描述的这个交互体验非常棒——**用户只需要"丢进去"，系统就"吐出来"**。让我拆解怎么实现。

---

## 核心体验目标

```
用户动作：拖入视频草稿/口播稿/参考音频 → （可选）选个风格倾向
系统输出：5-10首 TikTok爆款 + 商用安全 + 风格契合 的BGM
耗时：< 30秒
```

**关键词：零认知负担、不用想、不用搜、直接用**

---

## 1. 输入理解层：从素材中"读懂"用户要什么

### 三种输入类型的处理逻辑

| 输入类型 | 系统提取什么 | 技术方案 |
|---------|-------------|---------|
| **视频草稿** | 画面节奏、色调情绪、场景类型、剪辑节奏点 | 视频理解模型 |
| **口播稿（文本）** | 内容主题、情绪走向、节奏密度 | LLM语义分析 |
| **参考音频** | 风格指纹（BPM、调性、乐器、能量曲线） | 音频嵌入模型 |

### 视频草稿分析 Pipeline

```
视频输入
    ↓
┌─────────────────────────────────────────┐
│ Step 1: 视觉分析                          │
│ - 场景识别（室内/户外/产品特写/人物）        │
│ - 色调提取（暖色/冷色/高饱和/低饱和）        │
│ - 运镜节奏（快切/慢推/静态）                │
└─────────────────────────────────────────┘
    ↓
┌─────────────────────────────────────────┐
│ Step 2: 时间结构分析                       │
│ - 自动检测"节奏点"（转场、动作高峰）         │
│ - 生成"情绪曲线"（开头平→中间升→结尾收）    │
│ - 计算理想BPM范围                          │
└─────────────────────────────────────────┘
    ↓
┌─────────────────────────────────────────┐
│ Step 3: 生成"BGM需求向量"                  │
│ {                                        │
│   "energy": 0.7,      // 能量感           │
│   "valence": 0.8,     // 积极/消极        │
│   "tempo_range": [100, 120],  // BPM     │
│   "mood_tags": ["uplifting", "modern"],  │
│   "scene_type": "product_showcase"       │
│ }                                        │
└─────────────────────────────────────────┘
```

### 口播稿分析 Pipeline

```
文本输入（口播稿）
    ↓
┌─────────────────────────────────────────┐
│ LLM 分析（Prompt）                        │
│                                          │
│ "分析这段口播稿，输出：                     │
│  1. 内容垂类（美妆/知识/剧情/带货...）      │
│  2. 情绪基调（励志/轻松/紧张/温馨...）      │
│  3. 节奏感（信息密集型/舒缓叙事型）         │
│  4. 推荐的BGM风格关键词（3-5个）           │
│  5. 估算视频时长和节奏点位置"              │
└─────────────────────────────────────────┘
    ↓
输出示例：
{
  "category": "美妆教程",
  "mood": "轻松愉快，略带俏皮",
  "pace": "中等，每15秒一个信息点",
  "bgm_keywords": ["轻电子", "明亮", "有律动感", "不抢人声"],
  "estimated_duration": 45,
  "beat_points": [0, 15, 30, 42]  // 建议的节奏对齐点
}
```

### 参考音频分析 Pipeline

```
音频输入（哪怕只有10秒）
    ↓
┌─────────────────────────────────────────┐
│ 音频特征提取                              │
│ - BPM检测（librosa）                      │
│ - 调性分析（大调/小调）                    │
│ - 能量包络（响度曲线）                     │
│ - 乐器识别（电子/原声/人声占比）            │
└─────────────────────────────────────────┘
    ↓
┌─────────────────────────────────────────┐
│ CLAP嵌入生成                              │
│ - 将音频编码为512维向量                    │
│ - 这个向量代表"这首歌的风格指纹"            │
└─────────────────────────────────────────┘
    ↓
直接用于相似度检索
```

---

## 2. BGM曲库层：预先建好的"弹药库"

### 曲库构建策略

```
数据源：
├── TikTok Commercial Music Library（官方商用库）
├── Epidemic Sound / Artlist（订阅制正版）
├── Pixabay / Uppbeat（免费商用）
└── TikTok热门BGM追踪（每日更新）

每首歌存储：
{
  "id": "xxx",
  "title": "Sunny Day",
  "source": "tiktok_commercial",
  "license": "commercial_safe",
  
  // 音频特征
  "bpm": 112,
  "key": "C major",
  "energy": 0.75,
  "valence": 0.82,
  "audio_embedding": [0.12, -0.34, ...],  // CLAP向量
  
  // 元数据
  "mood_tags": ["happy", "uplifting", "bright"],
  "genre": "pop_electronic",
  "instruments": ["synth", "piano", "drums"],
  
  // 热度数据（每日更新）
  "tiktok_usage_count": 125000,
  "usage_growth_7d": 0.34,  // 过去7天增长34%
  "trending_score": 8.5,
  
  // 使用场景分析
  "common_categories": ["beauty", "lifestyle", "product"],
  "typical_video_length": [15, 30],
  
  // 链接
  "preview_url": "https://...",
  "tiktok_sound_url": "https://...",
  "download_url": "https://..."  // 如果有
}
```

### 曲库规模建议

| 阶段 | 曲库规模 | 来源 |
|------|---------|------|
| MVP | 500-1000首 | TikTok热门 + Pixabay精选 |
| V1.0 | 5000首 | 加入Epidemic Sound |
| V2.0 | 20000+ | 多平台聚合 + 自动扩充 |

---

## 3. 匹配算法层：找到"对的那几首"

### 多维度匹配逻辑

```
用户输入 → BGM需求向量
              ↓
┌─────────────────────────────────────────────────┐
│              多维度评分                           │
├─────────────────────────────────────────────────┤
│                                                 │
│  风格相似度（40%权重）                            │
│  ├── 如果有参考音频：CLAP向量余弦相似度            │
│  └── 如果无参考：mood_tags + genre 匹配度         │
│                                                 │
│  节奏匹配度（25%权重）                            │
│  ├── BPM是否在理想范围内                         │
│  └── 能量曲线是否与视频节奏点对齐                  │
│                                                 │
│  场景适配度（20%权重）                            │
│  └── 该BGM历史使用场景是否与用户垂类匹配           │
│                                                 │
│  热度分（15%权重）                                │
│  ├── trending_score（正在爆的）                  │
│  └── 但也保留2-3首"小众高质"选项                  │
│                                                 │
└─────────────────────────────────────────────────┘
              ↓
         排序 + 去重 + 多样性保证
              ↓
         输出 Top 5-10
```

### 多样性策略

不能全推相似的，要有层次：

```
推荐结果组成：
├── 2-3首：高度匹配 + 正在爆（"稳妥之选"）
├── 2-3首：高度匹配 + 小众（"不撞款"）
├── 1-2首：略有差异但惊喜（"意外发现"）
└── 1首：经典长青款（"保底选项"）
```

---

## 4. 输出呈现层：让用户秒懂、秒选

### 界面设计草案

```
┌─────────────────────────────────────────────────────────┐
│  🎵 为你的视频找到了 8 首完美BGM                          │
│                                                         │
│  基于分析：你的视频是「美妆教程」风格                       │
│  情绪：轻快明亮 | 节奏：中速(110BPM左右) | 时长：45秒       │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  🔥 热门之选                                             │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 1. Sunshine Groove                              │   │
│  │    ⚡ TikTok 12.5万次使用 | 本周↑34%              │   │
│  │    🎹 轻电子+钢琴 | BPM 112 | 明亮愉快            │   │
│  │    ▶️ [试听] [预览同步效果] [TikTok原声页]        │   │
│  │    💡 常用于：美妆、好物分享、日常vlog             │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  │ 2. Morning Coffee                                │   │
│  │    ⚡ TikTok 8.2万次使用 | 稳定热门                │   │
│  │    ...                                           │   │
│                                                         │
│  💎 小众精选（不撞款）                                    │
│  │ 5. Fresh Start                                   │   │
│  │    ✨ 使用量 2.3万 | 风格匹配度 96%                │   │
│  │    ...                                           │   │
│                                                         │
│  🎲 意外惊喜                                             │
│  │ 7. Playful Moments                               │   │
│  │    💡 风格略俏皮，可能给视频加分                    │   │
│                                                         │
├─────────────────────────────────────────────────────────┤
│  [🔄 换一批]  [⚙️ 调整偏好：更欢快/更平静/更有节奏感]      │
└─────────────────────────────────────────────────────────┘
```

### "预览同步效果"功能（杀手级体验）

```
用户点击"预览同步效果"
    ↓
系统自动将BGM与用户视频草稿叠加
    ↓
播放15秒预览（自动对齐节奏点）
    ↓
用户直接感受"这首配上去什么效果"
    ↓
大幅减少决策时间
```

---

## 5. 技术栈建议

### 整体架构

```
┌─────────────────────────────────────────────────────┐
│                    前端界面                          │
│         Web App (Next.js) / 飞书小程序               │
└────────────────────────┬────────────────────────────┘
                         │
┌────────────────────────┴────────────────────────────┐
│                    API Gateway                       │
│                   (FastAPI / Go)                     │
└────────────────────────┬────────────────────────────┘
                         │
        ┌────────────────┼────────────────┐
        ↓                ↓                ↓
┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│  输入分析服务  │ │  匹配检索服务  │ │  曲库管理服务  │
├──────────────┤ ├──────────────┤ ├──────────────┤
│ 视频分析      │ │ 向量检索      │ │ 热度更新      │
│ 文本分析(LLM) │ │ 多维度排序    │ │ 新曲入库      │
│ 音频分析      │ │ 多样性保证    │ │ 版权校验      │
└──────────────┘ └──────────────┘ └──────────────┘
        │                │                │
        └────────────────┴────────────────┘
                         │
              ┌──────────┴──────────┐
              ↓                     ↓
      ┌─────────────┐       ┌─────────────┐
      │  向量数据库   │       │  关系数据库   │
      │  (Pinecone)  │       │ (PostgreSQL) │
      │  音频嵌入     │       │  曲库元数据   │
      └─────────────┘       └─────────────┘
```

### 关键技术选型

| 模块 | 推荐方案 | 备选 |
|------|---------|------|
| 视频理解 | Google Video Intelligence / 自建(CLIP+时序分析) | Azure Video Indexer |
| 文本分析 | Claude API / GPT-4 | 通义千问 |
| 音频嵌入 | CLAP (laion/clap-htsat-unfused) | MERT, Jukebox embeddings |
| 向量检索 | Pinecone | Milvus, Qdrant |
| BPM/调性分析 | librosa + essentia | Spotify Audio Features API |

---

## 6. MVP实现路径（4周）

### Week 1：曲库建设
- 采集TikTok Commercial Music Library元数据
- 对500首热门BGM生成CLAP嵌入
- 搭建PostgreSQL + Pinecone基础架构

### Week 2：输入分析
- 实现口播稿文本分析（LLM Prompt）
- 实现参考音频的CLAP嵌入提取
- 视频分析先用简化版（提取关键帧→CLIP分析）

### Week 3：匹配与输出
- 实现多维度评分算法
- 搭建Web界面（上传→分析→结果展示）
- 接入飞书Bot作为备选入口

### Week 4：优化与测试
- "预览同步效果"功能
- 找10个创作者内测
- 根据反馈调优匹配权重

---

## 7. 开放问题

1. **入口形态**：Web优先还是飞书Bot优先？
   - Web：体验更完整，预览效果好
   - 飞书Bot：融入工作流，但富交互受限

2. **视频草稿格式**：用户通常在什么阶段来找BGM？
   - 剪映导出的半成品？
   - 原始素材拼接？
   - 纯口播稿还没拍？

3. **商业模式**：
   - 免费 + 高级功能付费？
   - 按次付费？
   - 订阅制？

你觉得这个方案靠谱吗？哪些部分想继续深挖？